<!-- sources:
https://gist.github.com/mbostock/5977197
https://beta.observablehq.com/@mbostock/d3-scatterplot
https://github.com/mcnuttandrew/capp-30239/blob/master/week-7-d3/soln/index.js -->


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Reverse Scatter Plot</title>
  <link rel="stylesheet" type="text/css" href="main.css">
 
</head>
<body>

<script src="https://d3js.org/d3.v4.min.js"></script>

<h1>Reverse Scatter Plot</h1>
<h2>SNAP Benefits and Unemployment Rate 1989-2010</h2>
<script type="text/javascript">



var margin = {top: 50, right: 50, bottom: 50, left: 100},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

// setup x 
var xValue = function(d) { return d.Year;}, // data -> value
    xScale = d3.scaleLinear().range([width,0]),   
    xMap = function(d) { return xScale(xValue(d));}, // data -> display
    xAxis = d3.axisBottom(xScale);
    //.tickFormat(function(d) { return d + 1; });

// setup y
var yValue = function(d) { return d.BenefitDollarPerson;}, // data -> value
    yScale = d3.scaleLinear().range([0,height]), 
    yMap = function(d) { return yScale(yValue(d));}, // data -> display
    yAxis = d3.axisLeft(yScale);

// setup fill color
var cValue = function(d) { return d.UnemploymentRate;},
    color = d3.scaleOrdinal(d3.schemeCategory10);


// add the graph canvas to the body of the webpage
var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


//load json data
	var dataset;

	d3.json("./file.json", function(error, data) { 
		if (error) { //If error is not null, something went wrong. 
			console.log(error); //Log the error.
		} else { //If no error, the file loaded correctly. Yay! 
			console.log(data); //Log the data.
            //Include other code to execute after successful file load here
      dataset = data;
      generateVis(data);
      }
});


// draw figure
function generateVis(data) {
  // don't want dots overlapping axis, so add in buffer to data domain
    xScale.domain([d3.min(data, xValue)-1, d3.max(data, xValue)+1]);
    yScale.domain([d3.min(data, yValue)-1, d3.max(data, yValue)+1]);


  //Create a Reverse Scatterplot

  //create x axis
  // x-axis
    svg.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," - height - ")")
        .call(xAxis)
      .append("text")
        .attr("class", "label")
        .attr("x", width)
        .attr("y", -6)
        .style("text-anchor", "end")
        .text("Year");

// text label for the x axis
  svg.append("text")             
      .attr("transform","translate(" - (width/2) -" ," +
                           (height + margin.top + 20) + ")")
      .attr("dy", "1em")
      .attr("dx", "-1em")
      .style("text-anchor", "middle")
      .text("Year");



  //create y axis
    svg.append("g")
          .attr("class", "y axis")
          .call(yAxis)
          .append("text")
          .attr("transform", "translate(0," - width - ")")
          .attr("class", "label")
          .attr("transform", "rotate(-90)")
          .attr("y", 6)
          .attr("dy", ".71em")
          .style("text-anchor", "end")
          .text("Benefit Dollar Person");

  // text label for the y axis
  svg.append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 0 - margin.left+50)
      .attr("x",0 - (height / 2))
      .attr("dy", "1em")
      .style("text-anchor", "middle")
      .text("Benefit Dollar Person");      


    // draw points
    svg.selectAll(".dot")
        .data(data)
        .enter().append("circle")
        .attr("class", "dot")
        .attr("r", 5.5)
        .attr("cx", xMap)
        .attr("cy", yMap)
        .style("fill", function(d) { return color(cValue(d));})      


    // draw legend
  var legend = svg.selectAll(".legend")
      .data(color.domain())
      .enter().append("g")
      .attr("class", "legend")
      .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; })


  // draw legend colored rectangles
  legend.append("rect")
      .attr("x", width - 60)
      .attr("y", height-120)
      .attr("width", 18)
      .attr("height", 18)
      .style("fill", color);

  // draw legend text
  legend.append("text")
      .attr("x", width - 65)
      .attr("y", height-110)
      .attr("dy", ".35em")
      .style("text-anchor", "end")
      .text(function(d) { return d;})

  // add legend title
  svg.append("text")
      .text("Unemployment Rate")
      .attr("x", width - 120)
      .attr("y", height-130)
      ;
 

}
  


</script>

	
</body>
</html>
